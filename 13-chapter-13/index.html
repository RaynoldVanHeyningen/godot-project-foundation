
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../12-chapter-12/">
      
      
        <link rel="next" href="../14-chapter-14/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Chapter 13 - The AAA Blueprint: Godot Project Foundation for Scalability & Modding</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="sky" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-13-implementing-a-movementcomponent" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="The AAA Blueprint: Godot Project Foundation for Scalability &amp; Modding" class="md-header__button md-logo" aria-label="The AAA Blueprint: Godot Project Foundation for Scalability & Modding" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The AAA Blueprint: Godot Project Foundation for Scalability & Modding
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 13
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="The AAA Blueprint: Godot Project Foundation for Scalability &amp; Modding" class="md-nav__button md-logo" aria-label="The AAA Blueprint: Godot Project Foundation for Scalability & Modding" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The AAA Blueprint: Godot Project Foundation for Scalability & Modding
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-chapter-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-chapter-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-chapter-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-chapter-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 4
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-chapter-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-chapter-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-chapter-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-chapter-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-chapter-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-chapter-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-chapter-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 11
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-chapter-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter 13
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 13
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Goal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concept-explanation-the-movementcomponents-role" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concept Explanation: The MovementComponent's Role
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architectural-reasoning-interacting-with-the-entitys-children" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architectural Reasoning: Interacting with the Entity's Children
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-mindset-notes-physics-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production Mindset Notes: Physics Integration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-instructions-creating-and-integrating-the-movementcomponent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-Step Instructions: Creating and Integrating the MovementComponent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step Instructions: Creating and Integrating the MovementComponent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-the-movementcomponent-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Create the MovementComponent Script
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-chapter-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-chapter-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-chapter-16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-chapter-17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-chapter-18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 18
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-chapter-19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 19
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-chapter-20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 20
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-chapter-21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 21
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../22-chapter-22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 22
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../23-chapter-23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 23
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Goal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concept-explanation-the-movementcomponents-role" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concept Explanation: The MovementComponent's Role
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architectural-reasoning-interacting-with-the-entitys-children" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architectural Reasoning: Interacting with the Entity's Children
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-mindset-notes-physics-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production Mindset Notes: Physics Integration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-instructions-creating-and-integrating-the-movementcomponent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-Step Instructions: Creating and Integrating the MovementComponent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step Instructions: Creating and Integrating the MovementComponent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-the-movementcomponent-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Create the MovementComponent Script
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="chapter-13-implementing-a-movementcomponent">Chapter 13: Implementing a <code>MovementComponent</code></h1>
<h2 id="goal">Goal</h2>
<p>The goal of this chapter is to implement a dedicated <strong><code>MovementComponent</code></strong> that encapsulates all movement-related logic for an <code>Entity</code>. This component will extend our generic <code>Component</code> base script, interact with the <code>Entity</code>'s <code>CharacterBody2D</code> node, and utilize a <code>MovementData</code> resource for configuration. By doing so, we will formalize our movement system into a reusable, data-driven component, demonstrating how to build specific functionality with our compositional architecture.</p>
<h2 id="concept-explanation-the-movementcomponents-role">Concept Explanation: The <code>MovementComponent</code>'s Role</h2>
<p>A <code>MovementComponent</code> is a prime example of a specialized component. Its single responsibility is to provide movement capabilities to its <code>Entity</code>. This means it will:</p>
<ul>
<li><strong>Receive Input/Direction</strong>: Get a desired movement direction (e.g., from an <code>InputManager</code> for player control, or from an AI script for enemy movement).</li>
<li><strong>Apply Physics</strong>: Interact with the <code>Entity</code>'s physics body (like <code>CharacterBody2D</code> for 2D platformers/top-down, or <code>CharacterBody3D</code> for 3D) to apply velocity and handle collisions.</li>
<li><strong>Utilize Data</strong>: Read movement parameters (speed, acceleration, friction) from a <code>MovementData</code> resource.</li>
</ul>
<p>By isolating movement logic into this component, we achieve:</p>
<ul>
<li><strong>Reusability</strong>: The same <code>MovementComponent</code> script can be used for players, enemies, or even movable platforms, simply by attaching it to different <code>Entity</code> scenes and providing different <code>MovementData</code> resources.</li>
<li><strong>Swappability</strong>: You could easily swap out a <code>GroundMovementComponent</code> for a <code>FlyingMovementComponent</code> without affecting other parts of the <code>Entity</code>.</li>
<li><strong>Clear Responsibility</strong>: All movement logic is in one place, making it easier to debug and modify.</li>
</ul>
<h2 id="architectural-reasoning-interacting-with-the-entitys-children">Architectural Reasoning: Interacting with the <code>Entity</code>'s Children</h2>
<p>The <code>MovementComponent</code> will demonstrate how components interact with other child nodes of their <code>Entity</code> owner. Specifically:</p>
<ul>
<li>It needs to find and control the <code>CharacterBody2D</code> node that is also a child of the <code>Entity</code>.</li>
<li>It will read configuration from a <code>MovementData</code> resource, reinforcing data-driven design.</li>
<li>It will receive input, potentially from our global <code>InputManager</code> (for player movement), but could also be driven by AI.</li>
</ul>
<p>This interaction pattern (<code>Component</code> -&gt; <code>Entity</code> -&gt; <code>Sibling Physics Node</code> -&gt; <code>Resource Data</code>) is a core aspect of our compositional approach. The <code>Component</code> base script's <code>get_owner_entity()</code> and <code>get_sibling_component()</code> helpers will be invaluable here.</p>
<h2 id="production-mindset-notes-physics-integration">Production Mindset Notes: Physics Integration</h2>
<ul>
<li><strong><code>_physics_process()</code></strong>: Movement logic that interacts with Godot's physics engine (<code>CharacterBody2D</code>, <code>RigidBody2D</code>, etc.) should always be placed in <code>_physics_process(delta)</code>. This ensures consistent behavior regardless of frame rate.</li>
<li><strong><code>move_and_slide()</code></strong>: For <code>CharacterBody2D</code>, <code>move_and_slide()</code> is the recommended method for movement, as it handles collisions, sliding along surfaces, and returning collision information.</li>
<li><strong>Separation</strong>: The <code>MovementComponent</code> <em>controls</em> the <code>CharacterBody2D</code> but does not <em>own</em> its physics properties (like mass, gravity scale, collision layers). Those are configured directly on the <code>CharacterBody2D</code> node or through its physics material resources.</li>
</ul>
<h2 id="step-by-step-instructions-creating-and-integrating-the-movementcomponent">Step-by-Step Instructions: Creating and Integrating the <code>MovementComponent</code></h2>
<p>We will replace our temporary <code>PlayerMovementTest.gd</code> with a proper <code>MovementComponent.gd</code> attached directly to the <code>Player</code> <code>Entity</code>. This <code>MovementComponent</code> will then find the <code>CharacterBody2D</code> sibling and control it.</p>
<h3 id="1-create-the-movementcomponent-script">1. Create the <code>MovementComponent</code> Script</h3>
<ol>
<li>In <code>res://scripts/components/</code>, create a new script named <code>MovementComponent.gd</code>.</li>
<li>Ensure it <code>extends Component</code>.</li>
<li>
<p>Add the following code:</p>
<p>```gdscript</p>
<h1 id="movementcomponentgd">MovementComponent.gd</h1>
<p>extends Component
class_name MovementComponent</p>
<p>@export var movement_data: MovementData # Reference to the MovementData resource</p>
<p>var _character_body: CharacterBody2D = null
var _current_velocity: Vector2 = Vector2.ZERO</p>
<p>func _on_entity_ready():
    super._on_entity_ready() # Call base Component's _on_entity_ready
    if not is_instance_valid(get_owner_entity()): return</p>
<pre><code># Find the CharacterBody2D sibling node
_character_body = get_owner_entity().find_child("CharacterBody2D") as CharacterBody2D
if not _character_body:
    push_error("MovementComponent on '" + get_owner_entity().name + "': No CharacterBody2D child found. Disabling component.")
    set_physics_process(false) # Disable physics processing if no body to move
    return

if movement_data == null:
    push_error("MovementComponent on '" + get_owner_entity().name + "': movement_data resource not assigned. Disabling component.")
    set_physics_process(false)
    return

set_physics_process(true) # Enable physics processing once ready
print("MovementComponent on '" + get_owner_entity().name + "' ready. CharacterBody2D found.")
</code></pre>
<h1 id="public-method-to-set-the-desired-movement-direction">Public method to set the desired movement direction</h1>
<p>func set_direction(direction: Vector2):
    if not is_instance_valid(movement_data): return
    _current_velocity = direction * movement_data.speed</p>
<p>func _physics_process(delta: float):
    if not is_instance_valid(_character_body): return</p>
<pre><code># Apply movement
_character_body.velocity = _current_velocity
_character_body.move_and_slide()

# Reset current velocity if not actively being set by input (for next frame)
_current_velocity = Vector2.ZERO 
# Note: For more complex movement (e.g., acceleration, friction), 
# _current_velocity would be integrated over time, not reset to ZERO.
# We'll keep it simple for now, but the data is there for future expansion.
</code></pre>
<p>```</p>
<ul>
<li><strong><code>@export var movement_data: MovementData</code></strong>: Allows us to assign the data resource in the editor.</li>
<li><strong><code>_character_body</code></strong>: A cached reference to the <code>CharacterBody2D</code> node.</li>
<li><strong><code>_on_entity_ready()</code></strong>: Finds and caches the <code>CharacterBody2D</code>. It also performs validation checks.</li>
<li><strong><code>set_direction()</code></strong>: A public method for other scripts (like our <code>PlayerController</code> below) to tell the <code>MovementComponent</code> <em>where</em> to move.</li>
<li><strong><code>_physics_process()</code></strong>: This is where <code>_character_body.velocity</code> is set and <code>move_and_slide()</code> is called.</li>
</ul>
</li>
</ol>
<h3 id="2-create-a-playercontroller-component-new">2. Create a <code>PlayerController</code> Component (New)</h3>
<p>Since <code>MovementComponent</code> only <em>moves</em> the <code>CharacterBody2D</code> based on a <code>direction</code>, we need a separate component that <em>generates</em> that direction (e.g., from player input). This is another great example of separation of concerns.</p>
<ol>
<li>In <code>res://scripts/components/</code>, create a new script named <code>PlayerController.gd</code>.</li>
<li>Ensure it <code>extends Component</code>.</li>
<li>
<p>Add the following code:</p>
<p>```gdscript</p>
<h1 id="playercontrollergd">PlayerController.gd</h1>
<p>extends Component
class_name PlayerController</p>
<p>var _movement_component: MovementComponent = null
var _health_component: HealthComponent = null # For damage test</p>
<p>func _on_entity_ready():
    super._on_entity_ready()
    if not is_instance_valid(get_owner_entity()): return</p>
<pre><code># Find the MovementComponent sibling
_movement_component = get_sibling_component(MovementComponent)
if not _movement_component:
    push_error("PlayerController on '" + get_owner_entity().name + "': No MovementComponent sibling found. Disabling component.")
    set_process(false)
    set_physics_process(false)
    return

# Also get HealthComponent for damage testing
_health_component = get_sibling_component(HealthComponent)
if _health_component:
    _health_component.health_changed.connect(_on_health_changed)
    _health_component.died.connect(_on_died)
else:
    push_error("PlayerController on '" + get_owner_entity().name + "': No HealthComponent sibling found.")

set_process_input(true) # Enable input processing for this component
print("PlayerController on '" + get_owner_entity().name + "' ready.")
</code></pre>
<p>func _physics_process(delta: float):
    # Get movement direction from the global InputManager
    var direction = InputManager.get_movement_direction()
    _movement_component.set_direction(direction)</p>
<p>func _input(event: InputEvent):
    # Temporary: Take damage on "ui_accept" (Spacebar/Enter)
    if event.is_action_just_pressed("ui_accept"):
        if _health_component:
            _health_component.take_damage(10)
        else:
            print("PlayerController: Cannot take damage, HealthComponent not found.")</p>
<pre><code># Temporary: Switch skin on "ui_text_next" (E)
if event.is_action_just_pressed("ui_text_next"):
    var skin_component = get_sibling_component(SkinComponent) as SkinComponent
    if skin_component:
        var red_skin_data: PlayerSkinData = preload("res://data/game_data/PlayerSkinRed.tres")
        var blue_skin_data: PlayerSkinData = preload("res://data/game_data/PlayerSkinBlue.tres")

        if skin_component.get_current_skin_id() == blue_skin_data.id:
            skin_component.apply_skin_from_data(red_skin_data)
        else:
            skin_component.apply_skin_from_data(blue_skin_data)
    else:
        print("PlayerController: Cannot switch skin, SkinComponent not found.")
</code></pre>
<p>func _on_health_changed(current_health: int, max_health: int):
    print("PlayerController: Player Health: " + str(current_health) + "/" + str(max_health))</p>
<p>func _on_died():
    print("PlayerController: Player received 'died' signal. Handling player death!")
    # Stop processing input/movement when dead
    set_process(false)
    set_physics_process(false)
    set_process_input(false)
    # You might also want to hide the player or play a death animation
```</p>
<ul>
<li><strong><code>get_sibling_component(MovementComponent)</code></strong>: This is where our <code>Component</code> base script's utility method shines. The <code>PlayerController</code> easily finds its <code>MovementComponent</code> sibling.</li>
<li><strong><code>_physics_process()</code></strong>: Gets input and delegates the movement command to the <code>_movement_component</code>.</li>
<li><strong><code>_input()</code></strong>: Handles damage and skin switching for testing, again by finding sibling components.</li>
</ul>
</li>
</ol>
<h3 id="3-refactor-playertscn-to-use-new-components">3. Refactor <code>Player.tscn</code> to Use New Components</h3>
<p>We will now remove the old <code>PlayerMovementTest.gd</code> and add the new <code>MovementComponent</code> and <code>PlayerController</code>.</p>
<ol>
<li>Open <code>res://scenes/entities/Player.tscn</code>.</li>
<li>Select the <code>CharacterBody2D</code> node.</li>
<li>
<p>In the Inspector, remove the <code>PlayerMovementTest.gd</code> script by clicking the small "x" icon next to its name.</p>
<ul>
<li><em>Note</em>: The <code>CharacterBody2D</code> node itself does not <code>extends Component</code>. Its script (if it had one) would. But our <code>MovementComponent</code> will control it.</li>
</ul>
</li>
<li>
<p><strong>Add <code>MovementComponent</code></strong>:</p>
<ul>
<li>Select the root <code>Player</code> node (instance of <code>Entity.tscn</code>).</li>
<li>Click the "+" icon to add a new child <code>Node</code>.</li>
<li>Rename it to <code>MovementComponent</code>.</li>
<li>Attach <code>MovementComponent.gd</code> (<code>res://scripts/components/MovementComponent.gd</code>) to it.</li>
<li>In the Inspector for <code>MovementComponent</code>, drag <code>res://data/game_data/PlayerMovementData.tres</code> into the <code>Movement Data</code> slot.</li>
</ul>
</li>
<li>
<p><strong>Add <code>PlayerController</code> Component</strong>:</p>
<ul>
<li>Select the root <code>Player</code> node.</li>
<li>Click the "+" icon to add a new child <code>Node</code>.</li>
<li>Rename it to <code>PlayerController</code>.</li>
<li>Attach <code>PlayerController.gd</code> (<code>res://scripts/components/PlayerController.gd</code>) to it.</li>
</ul>
</li>
</ol>
<p>Your <code>Player.tscn</code> scene tree should now look like this:</p>
<pre><code>Player (Instance of Entity.tscn, with Entity.gd script)
├── Sprite (Sprite2D)
├── CharacterBody2D
│   └── CollisionShape2D
├── HealthComponent (Node with HealthComponent.gd script)
├── SkinComponent (Node with SkinComponent.gd script)
├── MovementComponent (Node with MovementComponent.gd script)
└── PlayerController (Node with PlayerController.gd script)
</code></pre>
<ol>
<li>Save <code>Player.tscn</code>.</li>
</ol>
<h3 id="4-test-the-new-movement-system">4. Test the New Movement System</h3>
<ol>
<li>Run <code>res://scenes/core/GameContext.tscn</code> (F5).</li>
<li>Navigate to the gameplay state (press Enter).</li>
<li>Observe the "Output" panel. You should see <code>MovementComponent</code> and <code>PlayerController</code> initializing messages.</li>
<li>Verify that player movement, damage (Spacebar), and skin switching (E) still work exactly as before. The external behavior is the same, but the internal architecture is now much more modular and robust.</li>
</ol>
<h2 id="consistency-check">Consistency Check</h2>
<p>You have successfully implemented a dedicated <code>MovementComponent</code> that extends our <code>Component</code> base and uses a <code>MovementData</code> resource. You also created a <code>PlayerController</code> component that handles input and delegates movement commands to the <code>MovementComponent</code>. This demonstrates a clear separation of concerns: input generation is separate from movement application, and both are separate from raw data. Your player's movement system is now fully compositional, data-driven, and highly reusable.</p>
<p>In the next chapter, we will further enhance our <code>HealthComponent</code> by solidifying its implementation and ensuring it communicates effectively via signals.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.expand", "content.code.copy"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>